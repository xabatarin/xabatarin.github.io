<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Top Spotify - Artistas y Canciones</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f3f3f3; text-align: center; padding: 2rem; }
        .button { background: #1DB954; color: #fff; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.2rem; cursor: pointer; text-decoration: none; }
        .button:hover { background: #14833b; }
        .list { margin: 2rem auto; max-width: 500px; text-align: left; }
        h2 { color: #1DB954; }
    </style>
</head>
<body>
    <h1>Ver tus artistas y canciones m치s escuchadas en Spotify</h1>
    <button class="button" onclick="login()">Iniciar sesi칩n con Spotify</button>
    <div id="result"></div>

<script>
const CLIENT_ID = '24e44232fd75456d92df0cc79125f0a7'; // <-- PON AQU칈 TU CLIENT_ID
const REDIRECT_URI = 'https://xabatarin.github.io/top_spotify.html'; // <-- PON AQU칈 TU REDIRECT_URI (debe estar registrado en Spotify)
const SCOPES = 'user-top-read';

function login() {
    alert("Funciona el bot칩n");
    const url = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(SCOPES)}`;
    window.location = url;
}

window.onload = function() {
    // Si hay token en la URL, 칰salo
    if (window.location.hash) {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const access_token = params.get('access_token');
        if (access_token) {
            document.querySelector('.button').style.display = 'none';
            getTop(access_token);
        }
    }
};

function getTop(token) {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = "<p>Cargando tus artistas y canciones m치s escuchadas...</p>";

    // Top artistas
    fetch('https://api.spotify.com/v1/me/top/artists?limit=10', {
        headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(r => r.json())
    .then(data => {
        let html = '<h2>游꿗 Tus artistas m치s escuchados</h2><ul class="list">';
        data.items.forEach(artist => {
            html += `<li>${artist.name}</li>`;
        });
        html += '</ul>';
        resultDiv.innerHTML = html;
    });

    // Top canciones
    fetch('https://api.spotify.com/v1/me/top/tracks?limit=10', {
        headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(r => r.json())
    .then(data => {
        let html = resultDiv.innerHTML;
        html += '<h2>游꿧 Tus canciones m치s escuchadas</h2><ul class="list">';
        data.items.forEach(track => {
            html += `<li>${track.name} <span style="color:#888;">(${track.artists.map(a=>a.name).join(', ')})</span></li>`;
        });
        html += '</ul>';
        resultDiv.innerHTML = html;
    });
}
</script>
</body>
</html>
